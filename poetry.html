<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>古诗欣赏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 - 绿白色调主题 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2D6A4F',      // 深绿色作为主色调
                        secondary: '#1B4332',    // 暗绿色作为文本色
                        accent: '#40916C',       // 中绿色作为强调色
                        light: '#F1FAEE',        // 浅绿色背景
                        highlight: '#A8DADC',    // 亮绿色用于强调
                    },
                    fontFamily: {
                        poetry: ['"Ma Shan Zheng"', '"Noto Serif SC"', 'serif'],
                        sans: ['"Noto Sans SC"', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow-light {
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.05);
            }
            .bg-pattern {
                background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2340916c' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            }
            .content-auto {
                content-visibility: auto;
            }
            .touch-target {
                min-height: 48px;
                min-width: 48px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
    </style>
    
    <!-- 引入中文字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300;400;500&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* 移动设备触摸反馈优化 */
        button {
            -webkit-tap-highlight-color: transparent;
        }
        
        /* 竖屏和横屏布局调整 */
        @media (orientation: landscape) and (max-width: 1024px) {
            #content {
                max-height: 60vh;
                overflow-y: auto;
                padding: 10px 0;
            }
        }
        
        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(45, 106, 79, 0.2);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
    </style>
</head>
<body class="overflow-hidden h-screen bg-gradient-to-br from-light to-white bg-pattern">
    <!-- 主容器 -->
    <div id="app" class="relative h-full w-full transition-all duration-700 ease-in-out">
        <!-- 内容区 -->
        <div class="relative z-20 h-full flex flex-col justify-between p-4 sm:p-6 md:p-12">
            <!-- 顶部信息 -->
            <div class="flex justify-between items-start">
                <div class="text-primary/80 text-sm md:text-base">
                    <span id="current-page">1</span> / <span id="total-pages">75</span>
                </div>
            </div>
            
            <!-- 古诗内容：在移动设备上允许滚动 -->
            <div class="flex-grow flex flex-col items-center justify-center text-center px-3 md:px-4 lg:px-20 overflow-hidden">
                <div class="max-w-full max-h-[60vh] sm:max-h-[70vh] overflow-y-auto py-2">
                    <h1 id="title" class="font-poetry text-2xl sm:text-3xl md:text-5xl lg:text-6xl text-primary mb-2 md:mb-3 text-shadow-light transition-all duration-500 transform hover:scale-105"></h1>
                    <div id="dynasty-author" class="font-sans text-sm sm:text-base md:text-lg text-accent italic mb-6 md:mb-8"></div>
                    <div id="content" class="font-poetry text-lg sm:text-xl md:text-2xl lg:text-3xl text-secondary leading-loose md:leading-loose whitespace-pre-line"></div>
                </div>
            </div>
            
            <!-- 控制区：移动设备增大触摸区域 -->
            <div class="flex justify-between items-end">
                <!-- 上一页按钮 -->
                <button id="prev-btn" class="touch-target bg-primary/10 hover:bg-primary/20 text-primary p-3 md:p-4 rounded-full transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary/30 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fa fa-arrow-left text-xl md:text-2xl"></i>
                </button>
                
                <!-- 播放按钮 -->
                <button id="play-btn" class="touch-target bg-accent/90 hover:bg-accent text-white p-4 md:p-6 rounded-full transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-accent/50">
                    <i class="fa fa-play text-2xl md:text-3xl"></i>
                </button>
                
                <!-- 下一页按钮 -->
                <button id="next-btn" class="touch-target bg-primary/10 hover:bg-primary/20 text-primary p-3 md:p-4 rounded-full transition-all duration-300 transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary/30">
                    <i class="fa fa-arrow-right text-xl md:text-2xl"></i>
                </button>
            </div>
        </div>
        
        <!-- 加载提示 -->
        <div id="loading" class="fixed inset-0 z-50 flex items-center justify-center bg-light/80 hidden">
            <div class="text-primary text-2xl">加载中...</div>
        </div>
        
        <!-- 移动端提示（首次加载显示） -->
        <div id="mobile-hint" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-30 bg-primary/10 text-primary px-4 py-2 rounded-full text-sm hidden md:block">
            <i class="fa fa-info-circle mr-1"></i> 点击空白处隐藏提示 | 空格键播放/暂停 | 方向键翻页
        </div>
    </div>

    <script>
        // 古诗数据
        const poems = [
            {
                title: "静夜思",
                dynasty: "唐代",
                author: "李白",
                content: "床前明月光，疑是地上霜。\n举头望明月，低头思故乡。"
            },
            {
                title: "望庐山瀑布",
                dynasty: "唐代",
                author: "李白",
                content: "日照香炉生紫烟，遥看瀑布挂前川。\n飞流直下三千尺，疑是银河落九天。"
            },
            {
                title: "春晓",
                dynasty: "唐代",
                author: "孟浩然",
                content: "春眠不觉晓，处处闻啼鸟。\n夜来风雨声，花落知多少。"
            },
            {
                title: "登鹳雀楼",
                dynasty: "唐代",
                author: "王之涣",
                content: "白日依山尽，黄河入海流。\n欲穷千里目，更上一层楼。"
            },
            {
                title: "江雪",
                dynasty: "唐代",
                author: "柳宗元",
                content: "千山鸟飞绝，万径人踪灭。\n孤舟蓑笠翁，独钓寒江雪。"
            }
            // ... 此处省略其他70首古诗数据
        ];

        // 当前页码
        let currentIndex = 0;
        // 语音合成对象
        let speechSynthesis = null;
        let utterance = null;
        let isPlaying = false;
        let speechInitialized = false;

        // DOM元素
        const app = document.getElementById('app');
        const titleEl = document.getElementById('title');
        const dynastyAuthorEl = document.getElementById('dynasty-author');
        const contentEl = document.getElementById('content');
        const currentPageEl = document.getElementById('current-page');
        const totalPagesEl = document.getElementById('total-pages');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const playBtn = document.getElementById('play-btn');
        const loadingEl = document.getElementById('loading');
        const mobileHint = document.getElementById('mobile-hint');

        // 初始化语音合成
        function initSpeech() {
            if (!speechInitialized && 'speechSynthesis' in window) {
                speechSynthesis = window.speechSynthesis;
                
                // 处理语音列表加载事件
                speechSynthesis.onvoiceschanged = function() {
                    speechInitialized = true;
                };
                
                // 主动触发语音列表加载
                speechSynthesis.getVoices();
                speechInitialized = true;
            }
        }

        // 初始化应用
        function init() {
            // 设置总页数
            totalPagesEl.textContent = poems.length;
            
            // 加载第一首诗
            loadPoem(currentIndex);
            
            // 绑定事件 - 所有交互都先初始化语音
            prevBtn.addEventListener('click', () => {
                initSpeech();
                goToPrev();
            });
            
            nextBtn.addEventListener('click', () => {
                initSpeech();
                goToNext();
            });
            
            playBtn.addEventListener('click', () => {
                initSpeech();
                togglePlay();
            });
            
            // 点击空白处隐藏提示
            app.addEventListener('click', (e) => {
                if (!e.target.closest('button')) {
                    initSpeech();
                    mobileHint.classList.add('hidden');
                }
            });
            
            // 键盘导航
            document.addEventListener('keydown', (e) => {
                initSpeech();
                handleKeyPress(e);
            });
            
            // 触摸滑动支持（移动端）
            let touchStartX = 0;
            let touchEndX = 0;
            
            document.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
            }, false);
            
            document.addEventListener('touchend', (e) => {
                initSpeech();
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, false);
            
            function handleSwipe() {
                const swipeThreshold = 50;
                if (touchEndX - touchStartX > swipeThreshold) {
                    goToPrev();
                } else if (touchStartX - touchEndX > swipeThreshold) {
                    goToNext();
                }
            }
            
            // 屏幕旋转时重新布局
            window.addEventListener('orientationchange', () => {
                loadPoem(currentIndex);
            });
        }

        // 加载指定索引的诗
        function loadPoem(index) {
            // 显示加载状态
            loadingEl.classList.remove('hidden');
            
            const poem = poems[index];
            
            // 更新内容（添加淡入效果）
            app.classList.add('opacity-0');
            setTimeout(() => {
                titleEl.textContent = poem.title;
                dynastyAuthorEl.textContent = `${poem.dynasty} · ${poem.author}`;
                contentEl.textContent = poem.content;
                currentPageEl.textContent = index + 1;
                
                // 重置播放状态
                stopPlay();
                
                app.classList.remove('opacity-0');
                loadingEl.classList.add('hidden');
            }, 300);
            
            // 更新按钮状态
            updateButtonStates();
        }

        // 上一页
        function goToPrev() {
            if (currentIndex > 0) {
                currentIndex--;
                loadPoem(currentIndex);
            }
        }

        // 下一页
        function goToNext() {
            if (currentIndex < poems.length - 1) {
                currentIndex++;
                loadPoem(currentIndex);
            }
        }

        // 更新按钮状态
        function updateButtonStates() {
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === poems.length - 1;
            
            if (prevBtn.disabled) {
                prevBtn.classList.add('opacity-30');
            } else {
                prevBtn.classList.remove('opacity-30');
            }
            
            if (nextBtn.disabled) {
                nextBtn.classList.add('opacity-30');
            } else {
                nextBtn.classList.remove('opacity-30');
            }
        }

        // 播放/暂停朗读
        function togglePlay() {
            mobileHint.classList.add('hidden');
            
            if (isPlaying) {
                stopPlay();
            } else {
                startPlay();
            }
        }

        // 开始朗读（兼容Safari和华为浏览器）
        function startPlay() {
            // 停止任何正在进行的朗读
            stopPlay();
            
            // 检查浏览器是否支持语音合成
            if (!('speechSynthesis' in window)) {
                alert('您的浏览器不支持语音朗读功能，请更换浏览器（如Chrome）重试');
                return;
            }
            
            const poem = poems[currentIndex];
            const textToRead = `${poem.title}，${poem.dynasty}${poem.author}。${poem.content.replace(/\n/g, '。')}`;
            
            // 获取可用语音并选择中文语音
            let voices = speechSynthesis.getVoices();
            let chineseVoice = null;
            
            // 遍历语音列表查找中文语音
            for (let i = 0; i < voices.length; i++) {
                const voice = voices[i];
                if (voice.lang.includes('zh-CN') || voice.name.includes('中文') || voice.name.includes('Chinese')) {
                    chineseVoice = voice;
                    break;
                }
            }
            
            // 创建语音实例
            utterance = new SpeechSynthesisUtterance(textToRead);
            
            // 设置中文语音（如找到）
            if (chineseVoice) {
                utterance.voice = chineseVoice;
            } else {
                alert('未检测到中文语音包，将使用默认语音朗读');
            }
            
            // 基础配置
            utterance.lang = 'zh-CN';
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            utterance.rate = isMobile ? 0.8 : 0.9;
            utterance.pitch = 1.1;
            utterance.volume = 1;
            
            // 朗读结束回调
            utterance.onend = function() {
                isPlaying = false;
                playBtn.innerHTML = '<i class="fa fa-play text-2xl md:text-3xl"></i>';
            };
            
            // 错误处理
            utterance.onerror = function(event) {
                console.error('语音合成错误:', event.error);
                let errorMsg = '语音朗读失败，请重试';
                
                if (event.error === 'not-allowed') {
                    errorMsg = '语音朗读权限被拒绝，请在浏览器设置中开启权限';
                } else if (event.error === 'audio-capture') {
                    errorMsg = '无法访问音频设备，请检查浏览器权限';
                }
                
                alert(errorMsg);
                isPlaying = false;
                playBtn.innerHTML = '<i class="fa fa-play text-2xl md:text-3xl"></i>';
            };
            
            // Safari需要延迟触发
            setTimeout(() => {
                speechSynthesis.speak(utterance);
            }, 100);
            
            isPlaying = true;
            playBtn.innerHTML = '<i class="fa fa-pause text-2xl md:text-3xl"></i>';
        }

        // 停止朗读
        function stopPlay() {
            if (isPlaying && utterance && speechSynthesis) {
                speechSynthesis.cancel();
                isPlaying = false;
                playBtn.innerHTML = '<i class="fa fa-play text-2xl md:text-3xl"></i>';
            }
        }

        // 键盘控制
        function handleKeyPress(e) {
            switch(e.key) {
                case 'ArrowLeft':
                    goToPrev();
                    break;
                case 'ArrowRight':
                    goToNext();
                    break;
                case ' ': // 空格键播放/暂停
                    e.preventDefault();
                    togglePlay();
                    break;
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
